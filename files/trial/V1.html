
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å››æ£±é”¥ç»¼åˆé—®é¢˜ Â· å¯è§†åŒ–å…¨è§£</title>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        body { font-family: -apple-system, "Microsoft YaHei", sans-serif; background-color: #f8fafc; margin: 0; overflow: hidden; }
        .handwritten { font-family: 'KaiTi', 'STKaiti', serif; font-weight: bold; }
        
        .label-3d {
            color: #0f172a; font-family: Arial, sans-serif; font-weight: bold; font-size: 14px;
            text-shadow: 0 0 4px white; pointer-events: none; user-select: none;
        }
        
        .axis-label { font-family: 'Times New Roman', serif; font-style: italic; font-weight: 900; font-size: 16px; text-shadow: 0 0 3px white; }
        
        #bg-logo {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 60%; opacity: 0.05; pointer-events: none; z-index: 0; filter: grayscale(100%);
        }

        #coord-panel {
            position: absolute; top: 10px; left: 10px; z-index: 20;
            background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(4px);
            padding: 8px 10px; border-radius: 8px; border: 1px solid rgba(0,0,0,0.1);
            font-family: 'Menlo', 'Monaco', monospace; font-size: 10px; color: #334155;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05); pointer-events: none;
        }
        .coord-row { display: flex; justify-content: space-between; gap: 15px; margin-bottom: 2px; }
        .coord-name { font-weight: 800; color: #2563eb; }

        .ctrl-btn {
            @apply px-3 py-1.5 bg-white border border-slate-300 rounded text-xs font-bold text-slate-600 shadow-sm active:bg-slate-100 transition-colors whitespace-nowrap flex items-center gap-1;
        }
        .ctrl-btn.active { @apply bg-blue-600 text-white border-blue-600 shadow-md; }
        
        mjx-container { font-size: 105% !important; }
    </style>

    <script type="importmap">
        { "imports": { "three": "https://unpkg.com/three@0.160.0/build/three.module.js", "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/" } }
    </script>
</head>
<body class="h-screen flex flex-col">

    <header class="bg-slate-900 text-white px-3 py-2 flex justify-between items-center z-50 shadow-md shrink-0 h-12">
        <div class="flex items-center gap-2">
            <span class="bg-gradient-to-r from-emerald-500 to-teal-600 px-2 py-0.5 rounded text-xs font-bold shadow-sm">Test 2.0</span>
        </div>
        <div class="absolute left-1/2 transform -translate-x-1/2 text-lg font-bold handwritten">é™ˆè€å¸ˆæ‰‹æ“æ•°ç†åŒ–</div>
        <div class="hidden sm:block text-xs opacity-80 font-bold tracking-widest">CHEN HUB</div>
    </header>

    <div class="flex-grow flex flex-col lg:flex-row overflow-hidden relative">
        
        <div class="w-full h-[35vh] lg:h-auto lg:w-[450px] bg-white border-b lg:border-r border-slate-200 z-20 overflow-y-auto shadow-sm flex-none p-4 relative order-1 lg:order-1">
            <div class="bg-blue-50 p-3 rounded-lg border border-blue-100 shadow-sm mb-4">
                <div class="text-[10px] font-bold text-blue-500 mb-1 uppercase tracking-wider">é¢˜ç›®</div>
                <div class="text-xs text-slate-800 leading-relaxed font-medium">
                    
å¦‚å›¾ï¼Œåœ¨å››æ£±é”¥ \(P-ABCD\) ä¸­ï¼Œ\(PA \perp\) å¹³é¢ \(ABCD\)ï¼Œåº•é¢ \(ABCD\) æ˜¯ç›´è§’æ¢¯å½¢ã€‚<br>
å…¶ä¸­ \(AD // BC\)ï¼Œ\(AB \perp AD\)ã€‚<br>
å·²çŸ¥ \(PA=4\)ï¼Œ\(AB=AD=\frac{1}{2}BC=2\)ï¼Œ\(E\) ä¸ºæ£± \(BC\) ä¸Šç‚¹ï¼Œä¸” \(BE=\frac{1}{4}BC\)ã€‚<br>
(1) æ±‚è¯ï¼š\(DE \perp\) å¹³é¢ \(PAC\)ï¼›<br>
(2) æ±‚äºŒé¢è§’ \(A-PC-D\) çš„ä½™å¼¦å€¼ï¼›<br>
(3) æ±‚ç‚¹ \(E\) åˆ°å¹³é¢ \(PCD\) çš„è·ç¦»ã€‚

                </div>
            </div>
            
    <div class="relative pl-4 border-l-2 border-blue-500 mb-4">
        <h3 class="text-sm font-bold text-slate-900 mb-1">Step 1: ç©ºé—´ç›´è§’åæ ‡ç³»æ„å»º</h3>
        <div class="text-xs text-slate-600 space-y-1 leading-relaxed">
            
        <span class="text-blue-600 font-bold">ğŸ‘‰ å¦‚å›¾å»ºç³» (çº¢x, è“y, ç»¿z)</span><br>
        ä»¥ \(A\) ä¸ºåŸç‚¹ï¼Œ\(AB, AD, AP\) æ‰€åœ¨ç›´çº¿åˆ†åˆ«ä¸º \(x, y, z\) è½´ã€‚<br>
        <div class="bg-slate-50 p-2 mt-1 rounded border border-slate-200 text-xs font-mono grid grid-cols-2 gap-1">
        <div>A(0,0,0)</div><div>P(0,0,4)</div>
        <div>B(2,0,0)</div><div>D(0,2,0)</div>
        <div>C(2,4,0)</div><div>E(2,1,0)</div>
        </div>
        <div class="text-[10px] text-gray-400 mt-1">æ³¨: \(BC=4, BE=1\)ï¼Œæ•… \(E\) åœ¨ \(B\) ç‚¹ \(y\) æ–¹å‘åŠ 1</div>
    
        </div>
    </div>
    
    <div class="relative pl-4 border-l-2 border-purple-500 mb-4">
        <h3 class="text-sm font-bold text-slate-900 mb-1">Step 2: (1) è¯æ˜ DE âŠ¥ å¹³é¢ PAC</h3>
        <div class="text-xs text-slate-600 space-y-1 leading-relaxed">
            
        \(\vec{DE} = (2, -1, 0)\)ï¼Œå¹³é¢ \(PAC\) å…³é”®å‘é‡ï¼š<br>
        \(\vec{AP} = (0, 0, 4)\)ï¼Œ\(\vec{AC} = (2, 4, 0)\)<br>
        è®¡ç®—ç‚¹ç§¯ï¼š<br>
        1. \(\vec{DE} \cdot \vec{AP} = 2\times0 + (-1)\times0 + 0 = 0 \Rightarrow DE \perp AP\)<br>
        2. \(\vec{DE} \cdot \vec{AC} = 2\times2 + (-1)\times4 + 0 = 4-4=0 \Rightarrow DE \perp AC\)<br>
        <span class="font-bold text-purple-700">\(\therefore DE \perp\) å¹³é¢ \(PAC\)</span>
    
        </div>
    </div>
    
    <div class="relative pl-4 border-l-2 border-slate-500 mb-4">
        <h3 class="text-sm font-bold text-slate-900 mb-1">Step 3: (2) äºŒé¢è§’ A-PC-D ä½™å¼¦å€¼</h3>
        <div class="text-xs text-slate-600 space-y-1 leading-relaxed">
            
        1. é¢ \(PAC\) æ³•å‘é‡ \(\vec{n_1}\)ï¼šç”±(1)çŸ¥ \(\vec{DE} \perp\) é¢ \(PAC\)<br>
           æ•…å– \(\vec{n_1} = \vec{DE} = (2, -1, 0)\)ã€‚<br>
        2. é¢ \(PCD\) æ³•å‘é‡ \(\vec{n_2}\)ï¼š<br>
           \(\vec{PD}=(0,2,-4), \vec{CD}=(-2,-2,0)\)ã€‚<br>
           è®¾ \(\vec{n_2}=(x,y,z)\)ï¼Œè§£å¾— \(\vec{n_2} = (-2, 2, 1)\)ã€‚<br>
        3. è®¡ç®—ä½™å¼¦ï¼š<br>
           \(\cos\theta = \frac{|\vec{n_1}\cdot\vec{n_2}|}{|\vec{n_1}||\vec{n_2}|} = \frac{|-4-2|}{ \sqrt{5} \cdot 3 } = \frac{6}{3\sqrt{5}} = \mathbf{\frac{2\sqrt{5}}{5}}\)ã€‚
    
        </div>
    </div>
    
    <div class="relative pl-4 border-l-2 border-orange-500 mb-4">
        <h3 class="text-sm font-bold text-slate-900 mb-1">Step 4: (3) ç‚¹ E åˆ°å¹³é¢ PCD çš„è·ç¦»</h3>
        <div class="text-xs text-slate-600 space-y-1 leading-relaxed">
            
        åˆ©ç”¨å‘é‡æŠ•å½±å…¬å¼ \(d = \frac{|\vec{DE} \cdot \vec{n_2}|}{|\vec{n_2}|}\)<br>
        <span class="text-[10px] text-gray-500">(æ³¨æ„: è¿™é‡Œå‘é‡DEæ°å¥½è¿æ¥Eä¸å¹³é¢ä¸Šç‚¹D)</span><br>
        \(\vec{DE} = (2, -1, 0), \vec{n_2} = (-2, 2, 1)\)<br>
        \(d = \frac{|-4 - 2 + 0|}{3} = \frac{6}{3} = \mathbf{2}\)ã€‚
    
        </div>
    </div>
    
            <div class="h-8"></div>
        </div>

        <div class="flex-grow relative bg-slate-50/50 h-full w-full overflow-hidden order-2 lg:order-2 flex flex-col" id="canvas-wrapper">
            
            <div class="bg-white/90 backdrop-blur border-b border-slate-200 p-2 z-10 shrink-0 flex gap-2 overflow-x-auto no-scrollbar justify-center lg:justify-start">
                <button id="btn-rotate" class="ctrl-btn active"><span>ğŸ”„</span> æ—‹è½¬</button>
                <button id="btn-plane1" class="ctrl-btn border-purple-200 text-purple-700 bg-purple-50">é¢PAC</button>
                <button id="btn-plane2" class="ctrl-btn border-orange-200 text-orange-700 bg-orange-50">é¢PCD</button>
                <button id="btn-line" class="ctrl-btn border-red-200 text-red-700 bg-red-50"><span>ğŸ“</span> ç›®æ ‡çº¿DE</button>
                <button id="btn-reset" class="ctrl-btn bg-slate-100 text-slate-500">å¤ä½</button>
            </div>

            <div id="canvas-container" class="flex-grow relative w-full overflow-hidden">
                <img id="bg-logo" src="" alt="Watermark">
                <div id="coord-panel">
                    <div class="border-b border-slate-200 mb-1 pb-1 font-bold text-slate-700">å»ºç³»åæ ‡ (Aä¸ºåŸç‚¹)</div>
                </div>
            </div>
            
            <div class="absolute bottom-2 right-2 text-[10px] text-slate-300 pointer-events-none select-none z-10">Powered by CHEN HUB</div>
        </div>
    </div>

    <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
        import { CSS2DRenderer, CSS2DObject } from 'three/addons/renderers/CSS2DRenderer.js';

        let scene, camera, renderer, labelRenderer, controls;
        let mainGroup;
        let isRotating = true;

        // åæ ‡æ˜ å°„: Math (x, y, z) -> Three (x, z, y)
        // Math: A(0,0,0), P(0,0,4)[z], B(2,0,0)[x], D(0,2,0)[y]
        // Three: Red=X(Math X), Blue=Z(Math Y), Green=Y(Math Z)
        
        const pointData = {
            A: { pos: [0, 0, 0], label: "A" },   // åŸç‚¹
            B: { pos: [2, 0, 0], label: "B" },   // xè½´
            D: { pos: [0, 0, 2], label: "D" },   // zè½´ (Math y)
            P: { pos: [0, 4, 0], label: "P" },   // yè½´ (Math z)
            C: { pos: [2, 0, 4], label: "C" },   // B + (0,4,0)_math -> B + (0,0,4)_three
            E: { pos: [2, 0, 1], label: "E" }    // B + 1/4 BC
        };

        // æ˜¾ç¤ºç”¨çš„åæ ‡ (å¯¹åº” Step 1 ä¸­çš„æ•°å­¦åæ ‡)
        const listData = [
            {n:"A", c:"(0,0,0)"}, 
            {n:"B", c:"(2,0,0)"}, 
            {n:"D", c:"(0,2,0)"}, 
            {n:"P", c:"(0,0,4)"}, 
            {n:"C", c:"(2,4,0)"}, 
            {n:"E", c:"(2,1,0)"}
        ];

        function init() {
            const container = document.getElementById('canvas-container');
            scene = new THREE.Scene();
            
            // è°ƒæ•´ç›¸æœºåˆå§‹ä½ç½®ï¼Œè·å¾—æœ€ä½³è§‚å¯Ÿè§†è§’
            camera = new THREE.PerspectiveCamera(40, container.clientWidth / container.clientHeight, 0.1, 100);
            camera.position.set(8, 6, 8);
            camera.lookAt(1, 1, 1);

            renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setSize(container.clientWidth, container.clientHeight);
            renderer.setPixelRatio(window.devicePixelRatio);
            container.appendChild(renderer.domElement);

            labelRenderer = new CSS2DRenderer();
            labelRenderer.setSize(container.clientWidth, container.clientHeight);
            labelRenderer.domElement.style.position = 'absolute';
            labelRenderer.domElement.style.top = '0px';
            labelRenderer.domElement.style.pointerEvents = 'none';
            container.appendChild(labelRenderer.domElement);

            controls = new OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;

            const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
            scene.add(ambientLight);
            const dirLight = new THREE.DirectionalLight(0xffffff, 0.8);
            dirLight.position.set(5, 10, 5);
            scene.add(dirLight);

            buildModel();
            fillCoordPanel();
            setupUI();

            window.addEventListener('resize', onWindowResize);
            animate();
            
            // åˆå§‹è½»å¾®æ—‹è½¬å±•ç¤ºç«‹ä½“æ„Ÿ
            mainGroup.rotation.y = 0.5; 
        }

        function resetView() {
            controls.reset();
            mainGroup.rotation.y = 0.5;
            camera.position.set(8, 6, 8);
            camera.lookAt(1, 1, 1);
        }

        function fillCoordPanel() {
            const panel = document.getElementById('coord-panel');
            listData.forEach(d => {
                const row = document.createElement('div');
                row.className = 'coord-row';
                row.innerHTML = `<span class="coord-name">${d.n}</span><span>${d.c}</span>`;
                panel.appendChild(row);
            });
        }

        function buildModel() {
            mainGroup = new THREE.Group();
            scene.add(mainGroup);

            // 1. åæ ‡è½´ (å¯¹è¾¹)
            // Xè½´ (çº¢è‰²) -> AB
            const arrowX = new THREE.ArrowHelper(new THREE.Vector3(1,0,0), new THREE.Vector3(0,0,0), 4, 0xef4444, 0.2, 0.1);
            mainGroup.add(arrowX);
            addLabel("x (AB)", new THREE.Vector3(4.2, 0, 0), "axis-label");
            
            // Zè½´ (è“è‰²) -> AD (Math y)
            const arrowZ = new THREE.ArrowHelper(new THREE.Vector3(0,0,1), new THREE.Vector3(0,0,0), 6, 0x3b82f6, 0.2, 0.1);
            mainGroup.add(arrowZ);
            addLabel("y (AD)", new THREE.Vector3(0, 0, 6.2), "axis-label");

            // Yè½´ (ç»¿è‰²) -> AP (Math z)
            const arrowY = new THREE.ArrowHelper(new THREE.Vector3(0,1,0), new THREE.Vector3(0,0,0), 6, 0x22c55e, 0.2, 0.1);
            mainGroup.add(arrowY);
            addLabel("z (AP)", new THREE.Vector3(0, 6.2, 0), "axis-label");

            // 2. å‡ ä½•é¡¶ç‚¹
            for (const [key, data] of Object.entries(pointData)) {
                const vec = new THREE.Vector3(...data.pos);
                const sphere = new THREE.Mesh(new THREE.SphereGeometry(0.08), new THREE.MeshBasicMaterial({ color: 0x1e293b }));
                sphere.position.copy(vec);
                mainGroup.add(sphere);
                addLabel(key, new THREE.Vector3(vec.x, vec.y + 0.15, vec.z), "label-3d");
            }

            // 3. æ£±
            // å®çº¿: PB, PC, PD, BC, CD
            const solidEdges = [['P','B'],['P','C'],['P','D'],['B','C'],['C','D']];
            // è™šçº¿: PA, AB, AD (è¢«é®æŒ¡) - ä½†ä¸ºäº†åæ ‡ç³»æ¸…æ™°ï¼ŒAB/AD å¯è®¾ä¸ºè½´é¢œè‰²
            // è¿™é‡Œä¸ºäº†ç¬¦åˆé¢˜ç›®â€œæ£±â€çš„æ¦‚å¿µï¼Œç»Ÿä¸€ç”»é»‘çº¿ï¼Œç”¨è½´çº¿åŒºåˆ†æ–¹å‘
            const allEdges = [
                ['P','A'], ['P','B'], ['P','C'], ['P','D'],
                ['A','B'], ['B','C'], ['C','D'], ['D','A']
            ];

            const lineMat = new THREE.LineBasicMaterial({ color: 0x1e293b, linewidth: 2 });
            // è™šçº¿æè´¨
            const dashedMat = new THREE.LineDashedMaterial({ color: 0x94a3b8, dashSize: 0.2, gapSize: 0.1 });

            allEdges.forEach(pair => {
                const p1 = new THREE.Vector3(...pointData[pair[0]].pos);
                const p2 = new THREE.Vector3(...pointData[pair[1]].pos);
                const geo = new THREE.BufferGeometry().setFromPoints([p1, p2]);
                
                // åˆ¤æ–­æ˜¯å¦ç”»è™šçº¿: PA, AD, AB (åœ¨èƒŒé¢)
                // è¿™é‡Œç®€å•å¤„ç†ï¼šä¸ºäº†çœ‹æ¸…åæ ‡è½´ï¼ŒPA, AD, AB ç”¨è™šçº¿æˆ–è€…ç»†çº¿
                let isHidden = (pair.includes('A') && (pair.includes('P') || pair.includes('D') || pair.includes('B')));
                
                if (isHidden) {
                    const l = new THREE.Line(geo, dashedMat);
                    l.computeLineDistances();
                    mainGroup.add(l);
                } else {
                    mainGroup.add(new THREE.Line(geo, lineMat));
                }
            });

            // 4. ç›®æ ‡çº¿ DE (çº¢è‰²è™šçº¿)
            const deMat = new THREE.LineDashedMaterial({ color: 0xdc2626, dashSize: 0.3, gapSize: 0.1, linewidth: 3 });
            const de = new THREE.Line(new THREE.BufferGeometry().setFromPoints([
                new THREE.Vector3(...pointData.D.pos), 
                new THREE.Vector3(...pointData.E.pos)
            ]), deMat);
            de.computeLineDistances(); de.name = "LineDE"; de.visible = false;
            mainGroup.add(de);

            // 5. é¢
            const createPlane = (names, color, id) => {
                const pts = names.map(n => new THREE.Vector3(...pointData[n].pos));
                const geo = new THREE.BufferGeometry().setFromPoints(pts);
                geo.setIndex([0,1,2, 0,2,1]); geo.computeVertexNormals();
                const mesh = new THREE.Mesh(geo, new THREE.MeshBasicMaterial({ color: color, side: THREE.DoubleSide, transparent: true, opacity: 0.3 }));
                mesh.name = id; mesh.visible = false;
                mainGroup.add(mesh);
            };
            createPlane(['P','A','C'], 0xa855f7, "PlanePAC"); // ç´«è‰²
            createPlane(['P','C','D'], 0xf97316, "PlanePCD"); // æ©™è‰²
        }

        function addLabel(text, pos, className) {
            const div = document.createElement('div');
            div.className = className; div.textContent = text;
            const label = new CSS2DObject(div);
            label.position.copy(pos);
            mainGroup.add(label);
        }

        function setupUI() {
            const toggle = (id, objName) => {
                const btn = document.getElementById(id);
                btn.addEventListener('touchstart', (e) => e.stopPropagation());
                btn.addEventListener('click', () => {
                    const obj = mainGroup.getObjectByName(objName);
                    if(obj) { obj.visible = !obj.visible; btn.classList.toggle('active'); }
                });
            };
            
            toggle('btn-line', 'LineDE');
            toggle('btn-plane1', 'PlanePAC');
            toggle('btn-plane2', 'PlanePCD');

            document.getElementById('btn-reset').addEventListener('click', resetView);
            
            const rotBtn = document.getElementById('btn-rotate');
            rotBtn.addEventListener('click', () => {
                isRotating = !isRotating;
                rotBtn.classList.toggle('active');
                rotBtn.innerHTML = isRotating ? '<span>ğŸ”„</span> æ—‹è½¬' : '<span>â¹ï¸</span> å·²æš‚åœ';
            });
        }

        function onWindowResize() {
            const container = document.getElementById('canvas-container');
            camera.aspect = container.clientWidth / container.clientHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(container.clientWidth, container.clientHeight);
            labelRenderer.setSize(container.clientWidth, container.clientHeight);
        }

        function animate() {
            requestAnimationFrame(animate);
            controls.update();
            if(isRotating) mainGroup.rotation.y -= 0.002;
            renderer.render(scene, camera);
            labelRenderer.render(scene, camera);
        }

        init();
    </script>
</body>
</html>
